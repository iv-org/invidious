<!DOCTYPE html>
<html lang="<%= env.get("preferences").as(Preferences).locale %>">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= yield_content "header" %>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=<%= ASSET_COMMIT %>">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=<%= ASSET_COMMIT %>">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=<%= ASSET_COMMIT %>">
    <link rel="manifest" href="/site.webmanifest?v=<%= ASSET_COMMIT %>">
    <link rel="mask-icon" href="/safari-pinned-tab.svg?v=<%= ASSET_COMMIT %>" color="#575757">
    <meta name="msapplication-TileColor" content="#575757">
    <meta name="theme-color" content="#575757">
    <link title="Invidious" type="application/opensearchdescription+xml" rel="search" href="/opensearch.xml">
    <link rel="stylesheet" href="/css/pure-min.css?v=<%= ASSET_COMMIT %>">
    <link rel="stylesheet" href="/css/grids-responsive-min.css?v=<%= ASSET_COMMIT %>">
    <link rel="stylesheet" href="/css/ionicons.min.css?v=<%= ASSET_COMMIT %>">
    <link rel="stylesheet" href="/css/default.css?v=<%= ASSET_COMMIT %>">
</head>

<% locale = LOCALES[env.get("preferences").as(Preferences).locale]? %>
<% dark_mode = env.get("preferences").as(Preferences).dark_mode %>

<body class="<%= dark_mode.blank? ? "no" : dark_mode %>-theme">
    <span style="display:none" id="dark_mode_pref"><%= env.get("preferences").as(Preferences).dark_mode %></span>
    <div class="pure-g">
        <div class="pure-u-1 pure-u-md-2-24"></div>
        <div class="pure-u-1 pure-u-md-20-24" id="contents">
            <div class="pure-g navbar h-box">
                <% if navbar_search %>
                    <div class="pure-u-1 pure-u-md-4-24">
                        <a href="/" class="index-link pure-menu-heading">Invidious</a>
                    </div>
                    <div class="pure-u-1 pure-u-md-12-24 searchbar">
                        <form class="pure-form" action="/search" method="get">
                            <fieldset>
                                <input type="search" style="width:100%" name="q" placeholder="<%= translate(locale, "search") %>" value="<%= env.get?("search").try {|x| HTML.escape(x.as(String)) } %>">
                                <button class="search-button" id="right-overlap-search-button"><i class="icon ion-md-search"></i></button>
                            </fieldset>
                        </form>
                    </div>
                <% end %>

                <div class="pure-u-1 pure-u-md-8-24 user-field">
                    <% if env.get? "user" %>
                        <div class="pure-u-1-4">
                            <a id="toggle_theme" href="/toggle_theme?referer=<%= env.get?("current_page") %>" class="pure-menu-heading">
                                <% if env.get("preferences").as(Preferences).dark_mode == "dark" %>
                                    <i class="icon ion-ios-sunny"></i>
                                <% else %>
                                    <i class="icon ion-ios-moon"></i>
                                <% end %>
                            </a>
                        </div>
                        <div class="pure-u-1-4">
                            <a id="notification_ticker" title="<%= translate(locale, "Subscriptions") %>" href="/feed/subscriptions" class="pure-menu-heading">
                                <% notification_count = env.get("user").as(User).notifications.size %>
                                <% if notification_count > 0 %>
                                    <span id="notification_count"><%= notification_count %></span> <i class="icon ion-ios-notifications"></i>
                                <% else %>
                                    <i class="icon ion-ios-notifications-outline"></i>
                                <% end %>
                            </a>
                        </div>
                        <div class="pure-u-1-4">
                            <a title="<%= translate(locale, "Preferences") %>" href="/preferences?referer=<%= env.get?("current_page") %>" class="pure-menu-heading">
                                <i class="icon ion-ios-cog"></i>
                            </a>
                        </div>
                        <% if env.get("preferences").as(Preferences).show_nick %>
                            <div class="pure-u-1-4">
                                <span id="user_name"><%= env.get("user").as(User).email %></span>
                            </div>
                        <% end %>
                        <div class="pure-u-1-4">
                            <form action="/signout?referer=<%= env.get?("current_page") %>" method="post">
                                <input type="hidden" name="csrf_token" value="<%= URI.encode_www_form(env.get?("csrf_token").try &.as(String) || "") %>">
                                <a class="pure-menu-heading" href="#">
                                    <input style="all:unset" type="submit" value="<%= translate(locale, "Log out") %>">
                                </a>
                            </form>
                        </div>
                    <% else %>
                        <div class="pure-u-1-3">
                            <a id="toggle_theme" href="/toggle_theme?referer=<%= env.get?("current_page") %>" class="pure-menu-heading">
                                <% if env.get("preferences").as(Preferences).dark_mode == "dark" %>
                                    <i class="icon ion-ios-sunny"></i>
                                <% else %>
                                    <i class="icon ion-ios-moon"></i>
                                <% end %>
                            </a>
                        </div>
                        <div class="pure-u-1-3">
                            <a title="<%= translate(locale, "Preferences") %>" href="/preferences?referer=<%= env.get?("current_page") %>" class="pure-menu-heading">
                                <i class="icon ion-ios-cog"></i>
                            </a>
                        </div>
                        <% if CONFIG.login_enabled %>
                            <div class="pure-u-1-3">
                                <a href="/login?referer=<%= env.get?("current_page") %>" class="pure-menu-heading">
                                    <%= translate(locale, "Log in") %>
                                </a>
                            </div>
                        <% end %>
                    <% end %>
                </div>
            </div>

            <% if CONFIG.banner %>
                <div class="h-box">
                    <h3><%= CONFIG.banner %></h3>
                </div>
            <% end %>

            <%= content %>
        </div>
        <div class="pure-u-1 pure-u-md-2-24"></div>
    </div>
    <script src="/js/handlers.js?v=<%= ASSET_COMMIT %>"></script>
    <script src="/js/themes.js?v=<%= ASSET_COMMIT %>"></script>
    <% if env.get? "user" %>
        <script src="/js/sse.js?v=<%= ASSET_COMMIT %>"></script>
        <script id="notification_data" type="application/json">
        <%=
        {
            "upload_text" => HTML.escape(translate(locale, "`x` uploaded a video")),
            "live_upload_text" => HTML.escape(translate(locale, "`x` is live"))
        }.to_pretty_json
        %>
        </script>
        <script src="/js/notifications.js?v=<%= ASSET_COMMIT %>"></script>
    <% end %>
    
    <% if buffer_footer %>
        <div id="footer_buffer"></div>
    <% end %>
    
    <footer class="pure-g">
        <div class="pure-u-1 pure-u-md-2-24"></div>
        <div class="h-box pure-u-1 pure-u-md-20-24">
            <div class="pure-u-1 footer-content">
                <div class="footer-section pure-u-1-4" id="about-invidious-description">
                    <b>Invidious</b>
                    <p><%=translate(locale, "invidious_footer_description")%></p>
                </div>
                <div class="footer-section">
                    <b class="footer-section-header"><%= translate(locale, "Navigation")%></b>
                    <ul class="pure-menu-list footer-section-list">
                        <li class="pure-menu-item footer-section-item">
                            <a href="/" title="<%= translate(locale, "Home")%>">
                                <%= translate(locale, "Home") %>
                            </a>
                        </li>
                        <li class="pure-menu-item footer-section-item">
                            <a href="/feed/popular" title="<%= translate(locale, "Popular")%>">
                                <%= translate(locale, "Popular") %>
                            </a>
                        </li>
                        <li class="pure-menu-item footer-section-item">
                            <a href="/feed/trending" title="<%= translate(locale, "Trending")%>" style="">
                                <%= translate(locale, "Trending") %>
                            </a>
                        </li>
                        <li class="pure-menu-item footer-section-item">
                            <a href="/search" title="<%= translate(locale, "Search")%>">
                                <%= translate(locale, "Search") %>
                            </a>
                        </li>
                        <li class="pure-menu-item footer-section-item">
                            <br>
                        </li>
                        <li class="pure-menu-item footer-section-item">
                            <a href="/preferences?referer=<%= env.get?("current_page") %>" title="<%= translate(locale, "Preferences")%>">
                                <%= translate(locale, "Preferences") %>
                            </a>
                        </li>
                        <% if CONFIG.login_enabled %>
                            <li class="pure-menu-item footer-section-item">
                                <% if env.get? "user" %>
                                    <form action="/signout?referer=<%= env.get?("current_page") %>" method="post">
                                        <input type="hidden" name="csrf_token" value="<%= URI.encode_www_form(env.get?("csrf_token").try &.as(String) || "") %>">
                                        <a href="#" title="<%= translate(locale, "Log out") %>">
                                            <input style="all:unset" type="submit" value="<%= translate(locale, "Log out") %>">
                                        </a>
                                    </form>
                                <% else %>
                                    <a href="/login?referer=<%= env.get?("current_page") %>" title="<%= translate(locale, "Log in") %>">
                                        <%= translate(locale, "Log in") %>
                                    </a>
                                <% end %>
                            </li>
                        <% end %>
                    </ul>
                </div>
                <div class="footer-section">
                  <b class="footer-section-header">Invidious</b>
                  <ul class="pure-menu-list footer-section-list">
                      <li class="pure-menu-item footer-section-item">
                          <a href="https://invidious.io" title="<%= translate(locale, "Project Homepage")%>">
                              <%= translate(locale, "Project Homepage") %>
                          </a>
                      </li>
                      <li class="pure-menu-item footer-section-item">
                          <a href="https://github.com/iv-org/invidious" title="<%= translate(locale, "Source Code")%>">
                              <%= translate(locale, "Source Code") %>
                          </a>
                      </li>
                      <li class="pure-menu-item footer-section-item">
                          <a href="https://github.com/iv-org/invidious/issues" title="<%= translate(locale, "Issue tracker")%>" style="">
                              <%= translate(locale, "Issue tracker") %>
                          </a>
                      </li>
                      <li class="pure-menu-item footer-section-item">
                          <a href="https://redirect.invidious.io" title="<%= translate(locale, "Public instances")%>">
                              <%= translate(locale, "Public instances") %>
                          </a>
                      </li>
                      <li class="pure-menu-item footer-section-item">
                          <a href="https://invidious.io/donate" title="<%= translate(locale, "Donate")%>">
                              <%= translate(locale, "Donate") %>
                          </a>
                      </li>
                      <li class="pure-menu-item footer-section-item">
                          <a href="https://matrix.to/#/#invidious:matrix.org" title="<%= translate(locale, "Matrix")%>">
                              <%= translate(locale, "Matrix") %>
                          </a>
                      </li>

                  </ul>                </div>
                <div class="footer-section">
                  <b class="footer-section-header"><%= translate(locale, "Support")%></b>
                  <ul class="pure-menu-list footer-section-list">
                      <li class="pure-menu-item footer-section-item">
                          <% link = CONFIG.instance_maintainer_email ? "mailto:#{CONFIG.instance_maintainer_email}" : "#"%>
                          <a href=<%=link%> title="<%= translate(locale, "Contact instance maintainer")%>">
                              <%= translate(locale, "Contact instance maintainer") %>
                          </a>
                      </li>
                      <li class="pure-menu-item footer-section-item">
                          <a href="https://github.com/iv-org/invidious/issues/new" title="<%= translate(locale, "Report a bug")%>">
                              <%= translate(locale, "Report a bug") %>
                          </a>
                      </li>
                      <li class="pure-menu-item footer-section-item">
                          <a href="#" title="<%= translate(locale, "FAQs")%>" style="">
                              <%= translate(locale, "FAQs") %>
                          </a>
                      </li>
                  </ul>                
                </div>
                <div class="footer-section">
                  <b class="footer-section-header"><%= translate(locale, "Legal")%></b>
                  <ul class="pure-menu-list footer-section-list">
                      <li class="pure-menu-item footer-section-item">
                          <a href="/licenses" title="<%= translate(locale, "Licenses")%>">
                              <%= translate(locale, "Licences") %>
                          </a>
                      </li>
                      <!-- TODO -->
                      <li class="pure-menu-item footer-section-item">
                          <a href="/privacy" title="<%= translate(locale, "Privacy")%>">
                              <%= translate(locale, "Privacy") %>
                          </a>
                      </li>
                  </ul>                
                </div>
            </div>
        </div>
        <!-- <%= translate(locale, "Current version: ") %> <%= CURRENT_VERSION %>-<%= CURRENT_COMMIT %> @ <%= CURRENT_BRANCH %> -->
        </div>
        <div class="pure-u-1 pure-u-md-2-24"></div>
    </footer>
</body>

</html>
